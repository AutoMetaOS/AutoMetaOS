<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>Search</title>
    <style>
        *::-webkit-scrollbar {
            display: none;
        }
    </style>
    <script>
        const URLpars = () => {
            const entries = new URLSearchParams( window.location.search ).entries();
            const params = {};
            for ( let entry of entries ) params[ entry[ 0 ] ] = entry[ 1 ];
            return params;
        }
        const preprocess = () => {
            const query = URLpars().q.split( ' ' ).map( e => e = e.charAt( 0 ).toUpperCase() + e.slice( 1 ) ).join( ' ' )
            document.body.innerHTML = `
                <h1>${ query }</h1>
            `+ document.body.innerHTML;
            document.title = query;
            // FIX IMAGES
            document.querySelectorAll( "img" ).forEach(
                ( e ) => {
                    if ( e.parentElement.parentElement.tagName === 'A' ) {
                        e.src = decodeURIComponent( e.parentElement.parentElement.href.replace( 'http://localhost:4000/imgres?imgurl=', '' ).split( '&' )[ 0 ] );
                    }
                }
            );
            // FIX LINKS
            document.querySelectorAll( "a" ).forEach( e => {
                if ( e.href.includes( '/url?' ) ) e.href = decodeURIComponent( e.href.replace( 'http://localhost:4000/url?q=', '' ).split( '&' )[ 0 ] )
            } );
            // MINIFY DIVS
            document.body.querySelectorAll( "*" ).forEach( ( el ) => {
                // REMOVE EMPTY
                if ( el.childNodes.length === 0 && el.tagName === 'DIV' ) el.remove();
                // THIS ISNT READY
                if ( el.attributes.length === 0 && el.tagName === 'DIV' && el.childNodes.length === 1 ) {
                    console.log( 0 );
                }
            } );
            // REMOVE RELATED
            document.querySelectorAll( 'h2' ).forEach( e => e.parentElement.parentElement.remove() );
            // Remove Undefines
            document.body.innerHTML = document.body.innerHTML.replace( /ï¿½/g, ' ' );

            document.head.querySelector( 'script' ).remove();
        }
    </script>

    <script>
        fetch( "/social/google/search?q=" + URLpars().q )
            .then( ( res ) => res.text() )
            .then( ( r ) => {
                let doc = new DOMParser().parseFromString( r, "text/html" );
                doc.querySelectorAll( "script, noscript, textarea, input, footer, header" ).forEach( ( e ) => e.remove() );
                document.body.innerHTML = new XMLSerializer().serializeToString( doc );
                document.body.appendChild( doc.head.querySelector( 'style' ) );
                document.querySelector( '#main' ).childNodes[ 0 ].remove();
                preprocess();
            } );
    </script>
</head>

<body xmlns:svg="http://www.w3.org/2000/svg"></body>

</html>